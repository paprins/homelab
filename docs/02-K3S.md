# Setup K3S
> WIP

## Setup Master

```
curl -sfL https://get.k3s.io | sh -s - server \
  --cluster-init \
  --disable servicelb \
  --disable traefik \
  --node-name api.k3s.foobar.ninja
```

```
sudo cat /var/lib/rancher/k3s/server/node-token
```

## Setup Agent

```
curl -sfL https://get.k3s.io | K3S_TOKEN=<YOUR_NODE_TOKEN> sh -s - agent \
  --server https://api.k3s.foobar.ninja:6443 \
  --node-name node1.k3s.foobar.ninja
```

Update this command and repeat for all other agents that you wish to configure.

## Connect from local

```
sudo cat /etc/rancher/k3s/k3s.yaml
```

On your machine, create a file `~/.kube/k3s-config.yml` with the contents of that file.

```
$ export KUBECONFIG=~/.kube/k3s-config.yml
$ kubectl cluster-info

Kubernetes control plane is running at https://api.k3s.foobar.ninja:6443
CoreDNS is running at https://api.k3s.foobar.ninja:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
Metrics-server is running at https://api.k3s.foobar.ninja:6443/api/v1/namespaces/kube-system/services/https:metrics-server:https/proxy

$ kubectl get ns

NAME              STATUS   AGE
default           Active   9m43s
kube-node-lease   Active   9m43s
kube-public       Active   9m43s
kube-system       Active   9m43s
```

